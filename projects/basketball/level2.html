<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Rapid Fire Free Throws — Level 2</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      color-scheme: light dark;
      font-family: "Space Grotesk", "Segoe UI", system-ui, sans-serif;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #0b1533 0%, #060913 55%, #030508 100%);
      color: #e8edff;
      padding: 2rem 1rem 3rem;
    }

    main {
      width: min(1024px, 100%);
      background: rgba(8, 12, 28, 0.75);
      border-radius: 20px;
      box-shadow: 0 32px 48px rgba(2, 4, 12, 0.7);
      padding: clamp(1.5rem, 4vw, 2.8rem);
      position: relative;
      overflow: hidden;
    }

    main::before {
      content: "";
      position: absolute;
      inset: -80% -40% auto;
      height: 180%;
      background: radial-gradient(circle at top left, rgba(118, 78, 255, 0.32), rgba(9, 15, 30, 0));
      z-index: 0;
      pointer-events: none;
    }

    main > * {
      position: relative;
      z-index: 1;
    }

    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      color: #8fa4ff;
      text-decoration: none;
      font-weight: 600;
      margin-bottom: 1.5rem;
      letter-spacing: 0.02em;
      transition: color 0.2s ease, transform 0.2s ease;
    }

    .back-link:hover,
    .back-link:focus {
      color: #ffd28f;
      transform: translateX(-2px);
    }

    h1 {
      margin: 0 0 1.25rem;
      font-size: clamp(2.4rem, 3.2vw + 1rem, 3.4rem);
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: #f8fbff;
      text-shadow: 0 18px 36px rgba(2, 6, 20, 0.8);
    }

    .level-nav {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 0.65rem 1rem;
      margin-bottom: 1.25rem;
      font-weight: 600;
      color: rgba(199, 209, 255, 0.88);
    }

    .level-link {
      display: inline-flex;
      align-items: center;
      padding: 0.45rem 1.4rem;
      border-radius: 999px;
      background: rgba(102, 122, 255, 0.14);
      color: inherit;
      text-decoration: none;
      transition: transform 0.2s ease, background 0.2s ease;
    }

    .level-link:hover,
    .level-link:focus {
      transform: translateY(-1px);
      background: rgba(255, 210, 143, 0.22);
    }

    .level-link--current {
      background: linear-gradient(135deg, #814bff, #3f82ff);
      color: #fff;
      box-shadow: 0 20px 36px rgba(63, 130, 255, 0.35);
    }

    .level-link--locked {
      opacity: 0.45;
      pointer-events: none;
      background: rgba(82, 96, 150, 0.22);
      color: rgba(179, 193, 252, 0.75);
      box-shadow: none;
    }

    .level-link--win.win-link--available {
      background: linear-gradient(135deg, #44d1ab, #4c85ff);
      color: #071226;
      box-shadow: 0 20px 34px rgba(70, 150, 255, 0.38);
    }

    .level-lock-text {
      font-size: 0.95rem;
      color: rgba(178, 191, 255, 0.75);
    }

    .level-requirement {
      margin: 0 0 1.4rem;
      padding: 1rem 1.3rem;
      border-radius: 16px;
      background: rgba(74, 90, 160, 0.28);
      color: rgba(220, 228, 255, 0.92);
      font-weight: 600;
      text-align: center;
    }

    .level-up-toast {
      margin: 0 0 1.3rem;
      padding: 0.95rem 1.25rem;
      border-radius: 16px;
      background: rgba(104, 226, 196, 0.22);
      color: rgba(16, 30, 58, 0.9);
      font-weight: 650;
      text-align: center;
      opacity: 0;
      transform: translateY(-8px);
      transition: opacity 0.2s ease, transform 0.2s ease;
    }

    .level-up-toast--visible {
      opacity: 1;
      transform: translateY(0);
    }

    .level-lock-banner {
      margin: 0 0 1.4rem;
      padding: 1rem 1.25rem;
      border-radius: 14px;
      background: rgba(74, 90, 160, 0.26);
      color: rgba(220, 228, 255, 0.92);
      font-weight: 600;
    }

    #hud {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem 1.4rem;
      align-items: center;
      justify-content: center;
      margin-bottom: 1.4rem;
      font-weight: 600;
    }

    #hud span {
      min-width: 150px;
      text-align: center;
      font-size: 1.05rem;
    }

    #hud button {
      appearance: none;
      border: none;
      border-radius: 999px;
      padding: 0.9rem 2.75rem;
      font-weight: 700;
      font-size: 1.05rem;
      letter-spacing: 0.03em;
      color: #0c1224;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease, filter 0.2s ease;
    }

    #hud button:disabled {
      cursor: not-allowed;
      filter: brightness(0.75);
      box-shadow: none;
    }

    #shoot {
      background: linear-gradient(135deg, #ffd28f, #ff8a5c);
      box-shadow: 0 18px 32px rgba(255, 162, 98, 0.35);
    }

    #shoot:not(:disabled):hover {
      transform: translateY(-2px);
      box-shadow: 0 22px 36px rgba(255, 162, 98, 0.4);
    }

    #stop {
      background: linear-gradient(135deg, #6c7bff, #3f4bff);
      color: #f5f7ff;
      box-shadow: 0 18px 32px rgba(96, 112, 255, 0.32);
    }

    #stop:not(:disabled):hover {
      transform: translateY(-2px);
      box-shadow: 0 22px 38px rgba(96, 112, 255, 0.38);
    }

    .level-intro {
      margin: 0 0 1.6rem;
      font-size: 1.05rem;
      line-height: 1.7;
      color: rgba(214, 222, 255, 0.9);
    }

    #controls {
      display: grid;
      gap: 0.9rem 1.2rem;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      margin-bottom: 1.6rem;
    }

    #controls label {
      display: grid;
      gap: 0.4rem;
      padding: 1rem 1.15rem;
      border-radius: 14px;
      background: rgba(40, 54, 112, 0.32);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.08);
      color: rgba(223, 229, 255, 0.88);
      font-size: 0.95rem;
    }

    #controls input[type="range"] {
      accent-color: #ffad66;
    }

    #controls span {
      font-size: 0.9rem;
      color: rgba(255, 210, 143, 0.85);
    }

    .court-wrapper {
      position: relative;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 32px 48px rgba(6, 9, 18, 0.75);
    }

    canvas {
      width: 100%;
      display: block;
      height: auto;
      background: radial-gradient(circle at 20% 30%, rgba(32, 53, 105, 0.85), rgba(6, 10, 22, 0.92));
    }

    #score-flash {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: clamp(2.4rem, 5vw, 3.4rem);
      font-weight: 800;
      color: rgba(255, 222, 190, 0.94);
      text-shadow: 0 14px 28px rgba(12, 8, 0, 0.6);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s ease;
    }

    #score-flash.visible {
      opacity: 1;
    }

    #run-history {
      margin-top: 2.6rem;
    }

    #run-history table {
      width: 100%;
      border-collapse: collapse;
      background: rgba(12, 18, 42, 0.7);
      border-radius: 16px;
      overflow: hidden;
    }

    #run-history th,
    #run-history td {
      padding: 0.85rem 1rem;
      text-align: left;
      font-size: 0.95rem;
    }

    #run-history thead {
      background: rgba(36, 49, 96, 0.9);
      color: rgba(226, 232, 255, 0.92);
    }

    #run-history tbody tr:nth-child(even) {
      background: rgba(20, 28, 58, 0.7);
    }

    #run-history tbody tr:nth-child(odd) {
      background: rgba(15, 23, 48, 0.7);
    }

    @media (max-width: 680px) {
      main {
        padding: 1.6rem 1.2rem 2.4rem;
      }

      #hud {
        flex-direction: column;
      }

      #hud span {
        width: 100%;
      }

      .level-nav {
        flex-direction: column;
        align-items: flex-start;
      }

      .level-link {
        width: 100%;
        justify-content: center;
      }

      #controls {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <main>
    <a class="back-link" href="./" aria-label="Back to Level 1">
      <span aria-hidden="true">⟵</span>
      Back to Level 1
    </a>
    <h1>Level 2 · Event Horizon</h1>
    <nav class="level-nav" aria-label="Basketball levels">
      <span>Levels:</span>
      <a class="level-link" href="./">Level 1</a>
      <span class="level-link level-link--current">Level 2</span>
      <a
        id="level3-link"
        class="level-link level-link--locked"
        href="./level3.html"
        aria-disabled="true"
        tabindex="-1"
      >
        Level 3
      </a>
      <a
        id="win-link"
        class="level-link level-link--locked level-link--win"
        href="./win.html"
        aria-disabled="true"
        tabindex="-1"
      >
        Win!
      </a>
      <span id="level2-lock-text" class="level-lock-text">Reach 70 on Level 1 to unlock this level.</span>
      <span id="level3-lock-text" class="level-lock-text">Score 40+ on Level 2 to unlock Level 3.</span>
    </nav>
    <p class="level-requirement">Score 40 or more on Level 2 to unlock Level 3 above.</p>
    <div
      id="level3-unlock-toast"
      class="level-up-toast"
      role="status"
      aria-live="polite"
      hidden
    ></div>
    <p id="level2-locked-message" class="level-lock-banner" hidden>
      Score 70 or more on Level 1 to breach the singularity. Once unlocked you'll see your best cosmic runs right here.
    </p>
    <div id="hud">
      <span id="score">Score: 0</span>
      <span id="balls">Balls in play: 0</span>
      <span id="timer">Timer: 0.0s</span>
      <button id="shoot">Start Gravity Well</button>
      <button id="stop" disabled>Abort Run</button>
    </div>
    <p class="level-intro">
      A rogue practice facility opened a miniature black hole at mid-court. Its gravity bends every shot—get too close and the
      ball vanishes beyond the event horizon. Thread the needle by curving throws into the hoop while steering clear of the
      singularity's hungry core.
    </p>
    <div id="controls">
      <label for="angle-control">
        Angle boost
        <input type="range" id="angle-control" min="-0.25" max="0.83" step="0.01" value="0.16" />
        <span id="angle-display">+9.2°</span>
      </label>
      <label for="power-control">
        Launch power
        <input type="range" id="power-control" min="14" max="39" step="0.1" value="20.5" />
        <span id="power-display">20.5 u/s</span>
      </label>
    </div>
    <div class="court-wrapper">
      <canvas id="court" width="960" height="540"></canvas>
      <div id="score-flash" role="status" aria-live="polite"></div>
    </div>
    <section id="run-history">
      <h2>Top 10 Runs</h2>
      <table>
        <thead>
          <tr>
            <th scope="col">Rank</th>
            <th scope="col">Timestamp</th>
            <th scope="col">Angle Boost</th>
            <th scope="col">Launch Power</th>
            <th scope="col">Spawn Rate</th>
            <th scope="col">Duration</th>
            <th scope="col">Score</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>
  </main>

  <script src="../shared/achievements.js"></script>
  <script src="common.js"></script>
  <script>
    const level3UnlockToast = document.getElementById('level3-unlock-toast');

    window.RapidFireFreeThrows.initGame({
      historyCookie: 'rapid_fire_runs_level2_v2',
      levelKey: 'level2',
      unlockThreshold: 70,
      unlockLockedText: 'Reach 70+ on Level 1 to unlock the Event Horizon.',
      unlockUnlockedText: 'Level 2 unlocked! Ride the gravity well.',
      level2LockTextId: 'level2-lock-text',
      lockBannerId: 'level2-locked-message',
      scoreFlashId: 'score-flash',
      simulationDurationMs: 11500,
      disableUntilUnlocked: true,
      blackHole: {
        x: 16.4,
        y: 8.2,
        radius: 2.45,
        eventHorizonRadius: 1.35,
        influenceRadius: 7.4,
        pullStrength: 265,
        spinStrength: 34,
        minDistance: 1.05,
        color: [0.12, 0.13, 0.24, 0.92],
        glowColor: [0.36, 0.46, 0.94, 0.32],
        horizonColor: [0.98, 0.62, 0.28, 0.95]
      },
      win: {
        threshold: 175,
        linkId: 'win-link',
        storageKey: 'rapid_fire_free_throws_level3_victory_unlocked'
      },
      getUnlockScore: helpers => helpers.getBestScoreFromCookie('rapid_fire_runs_level1_v1'),
      additionalLocks: [
        {
          linkId: 'level3-link',
          lockTextId: 'level3-lock-text',
          unlockThreshold: 40,
          lockedText: 'Score 40+ on Level 2 to unlock Level 3.',
          unlockedText: 'Level 3 unlocked! Deploy the roaming backboard.',
          storageKey: 'rapid_fire_free_throws_level3_unlocked',
          getUnlockScore: helpers => helpers.getBestScoreFromCookie('rapid_fire_runs_level2_v2'),
          onUnlockStateChange(unlocked, details) {
            if (!level3UnlockToast) {
              return;
            }
            if (unlocked && details && details.unlockedFromLatestScore) {
              const scoreValue = Number.isFinite(details.latestScore)
                ? Math.round(details.latestScore)
                : details.threshold;
              level3UnlockToast.textContent = `You scored ${scoreValue}! Level 3 is unlocked—advance above to challenge the moving board.`;
              level3UnlockToast.hidden = false;
              level3UnlockToast.classList.add('level-up-toast--visible');
            } else if (!unlocked) {
              level3UnlockToast.hidden = true;
              level3UnlockToast.classList.remove('level-up-toast--visible');
              level3UnlockToast.textContent = '';
            }
          }
        }
      ]
    });
  </script>
</body>
</html>
