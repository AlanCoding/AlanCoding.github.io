<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Rapid Fire Free Throws — Level 3</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      color-scheme: light dark;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      background: radial-gradient(circle at top, #f2f6ff, #d7e1ff 55%, #a4b5ff);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem 1rem 3rem;
    }

    main {
      max-width: 960px;
      width: 100%;
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(6px);
      border-radius: 18px;
      box-shadow: 0 24px 40px rgba(40, 52, 120, 0.25);
      padding: 2rem clamp(1rem, 3vw, 2.5rem) 3rem;
    }

    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
      font-weight: 600;
      margin-bottom: 1.5rem;
      color: #2f3d86;
      text-decoration: none;
      transition: transform 0.15s ease, color 0.15s ease;
    }

    .back-link:hover,
    .back-link:focus {
      color: #ff6c3c;
      transform: translateX(-3px);
    }

    .level-nav {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 0.75rem 1.2rem;
      margin-bottom: 1.5rem;
      font-weight: 600;
      color: #1f2b5c;
    }

    .level-link {
      position: relative;
      padding: 0.4rem 1.2rem;
      border-radius: 999px;
      background: rgba(63, 79, 155, 0.16);
      color: inherit;
      text-decoration: none;
      transition: transform 0.15s ease, background 0.15s ease;
    }

    .level-link:hover,
    .level-link:focus {
      transform: translateY(-2px);
      background: rgba(255, 108, 60, 0.18);
      outline: none;
    }

    .level-link--current {
      background: linear-gradient(135deg, rgba(255, 120, 44, 0.9), rgba(255, 78, 78, 0.9));
      color: #fff;
      box-shadow: 0 14px 24px rgba(240, 80, 40, 0.28);
    }

    .level-link--locked {
      opacity: 0.45;
      pointer-events: none;
      background: rgba(102, 112, 166, 0.22);
      color: rgba(32, 42, 92, 0.7);
      box-shadow: none;
    }

    .level-link--win.win-link--available {
      background: linear-gradient(135deg, rgba(64, 199, 157, 0.95), rgba(76, 133, 255, 0.95));
      color: #fff;
      box-shadow: 0 14px 24px rgba(64, 133, 214, 0.32);
    }

    .level-lock-text {
      font-size: 0.95rem;
      color: rgba(41, 58, 122, 0.9);
    }

    .level-lock-text strong {
      font-weight: 700;
    }

    .level-lock-banner {
      margin: 0 0 1rem;
      padding: 0.85rem 1rem;
      border-radius: 12px;
      background: rgba(63, 79, 155, 0.12);
      color: #1f2b5c;
      font-weight: 600;
    }

    .level-requirement {
      margin: 0 0 1.3rem;
      padding: 0.9rem 1.2rem;
      border-radius: 14px;
      background: rgba(63, 79, 155, 0.16);
      color: #1f2b5c;
      font-weight: 600;
      text-align: center;
    }

    h1 {
      font-size: clamp(2.2rem, 3vw + 1rem, 3.2rem);
      text-align: center;
      margin-top: 0;
      letter-spacing: 0.04em;
      color: #293a7a;
      text-shadow: 0 6px 16px rgba(25, 40, 92, 0.35);
    }

    #hud {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: center;
      gap: 1rem 2rem;
      margin-bottom: 1.5rem;
      font-weight: 600;
      color: #1f2b5c;
    }

    #hud span {
      min-width: 140px;
      text-align: center;
      font-size: 1.05rem;
    }

    #hud button {
      appearance: none;
      border: none;
      padding: 0.85rem 2.4rem;
      border-radius: 999px;
      font-size: 1.1rem;
      font-weight: 700;
      color: #fff;
      cursor: pointer;
      transition: transform 0.18s ease, box-shadow 0.18s ease, filter 0.18s ease;
    }

    #hud button:disabled {
      cursor: not-allowed;
      filter: grayscale(40%);
      box-shadow: none;
    }

    #shoot {
      background: linear-gradient(135deg, #ff782c, #ff4e4e);
      box-shadow: 0 18px 24px rgba(240, 80, 40, 0.3);
    }

    #shoot:disabled {
      background: #ffb48d;
      color: rgba(255, 255, 255, 0.8);
    }

    #shoot:not(:disabled):hover {
      transform: translateY(-2px);
      box-shadow: 0 20px 28px rgba(240, 80, 40, 0.35);
    }

    #stop {
      background: linear-gradient(135deg, #4f67ff, #3849d7);
      box-shadow: 0 18px 24px rgba(60, 82, 220, 0.3);
    }

    #stop:disabled {
      background: #9ba5ff;
      color: rgba(255, 255, 255, 0.85);
    }

    #stop:not(:disabled):hover {
      transform: translateY(-2px);
      box-shadow: 0 20px 28px rgba(60, 82, 220, 0.35);
    }

    canvas {
      width: 100%;
      height: auto;
      display: block;
      border-radius: 12px;
      border: 2px solid rgba(25, 40, 92, 0.15);
      background: linear-gradient(#9acbff, #87b7ff);
    }

    canvas.board-enabled {
      cursor: grab;
    }

    canvas.board-enabled.board-dragging {
      cursor: grabbing;
    }

    .win-progress {
      max-width: 640px;
      margin: 0 auto 1.3rem;
      box-shadow: 0 10px 18px rgba(40, 52, 120, 0.18);
    }

    .win-progress--unlocked {
      background: rgba(255, 120, 44, 0.18);
      color: #8c3515;
      box-shadow: 0 12px 22px rgba(214, 102, 49, 0.24);
    }

    .court-wrapper {
      position: relative;
    }

    #score-flash {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: clamp(2.4rem, 5vw, 3.6rem);
      font-weight: 800;
      color: rgba(255, 255, 255, 0.96);
      text-shadow: 0 10px 22px rgba(25, 30, 60, 0.45);
      background: radial-gradient(circle, rgba(22, 32, 78, 0.35), rgba(22, 32, 78, 0));
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s ease;
    }

    #score-flash.visible {
      opacity: 1;
    }

    #controls {
      display: grid;
      gap: 0.8rem 1.2rem;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      margin-bottom: 1.4rem;
      color: #1f2b5c;
      font-weight: 600;
    }

    #controls label {
      display: grid;
      gap: 0.35rem;
      font-size: 0.95rem;
      padding: 0.9rem 1rem;
      border-radius: 12px;
      background: rgba(71, 92, 156, 0.08);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.4);
    }

    #controls input[type="range"] {
      width: 100%;
      accent-color: #ff6c3c;
    }

    #controls span {
      font-size: 0.9rem;
      color: #293a7a;
    }

    p {
      margin-top: 1.75rem;
      line-height: 1.6;
      color: #2b3570;
      text-align: center;
    }

    .level-intro {
      margin: 0 0 1.3rem;
      text-align: left;
      font-size: 1.05rem;
      color: #1f2b5c;
    }

    #run-history {
      margin-top: 2.6rem;
    }

    #run-history h2 {
      font-size: clamp(1.4rem, 2vw + 1rem, 1.9rem);
      color: #24316d;
      text-align: center;
      margin-bottom: 1.1rem;
    }

    #run-history table {
      width: 100%;
      border-collapse: collapse;
      background: rgba(255, 255, 255, 0.86);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 12px 22px rgba(32, 44, 98, 0.14);
    }

    #run-history th,
    #run-history td {
      padding: 0.75rem 0.9rem;
      font-size: 0.95rem;
      text-align: left;
      color: #1f2b5c;
    }

    #run-history thead {
      background: linear-gradient(135deg, rgba(76, 99, 196, 0.95), rgba(56, 73, 175, 0.95));
      color: #fff;
    }

    #run-history tbody tr:nth-child(even) {
      background: rgba(132, 148, 220, 0.08);
    }

    #run-history tbody tr:hover {
      background: rgba(255, 193, 126, 0.25);
    }

    #run-history td:last-child {
      font-weight: 700;
    }
  </style>
</head>
<body>
  <main>
    <a class="back-link" href="./level2.html" aria-label="Back to Level 2">
      <span aria-hidden="true">⟵</span>
      Back to Level 2
    </a>
    <h1>Rapid Fire Free Throws · Level 3</h1>
    <nav class="level-nav" aria-label="Basketball levels">
      <span>Levels:</span>
      <a class="level-link" href="./">Level 1</a>
      <a class="level-link" href="./level2.html">Level 2</a>
      <span class="level-link level-link--current">Level 3</span>
      <a
        id="win-link"
        class="level-link level-link--locked level-link--win"
        href="./win.html"
        aria-disabled="true"
        tabindex="-1"
      >
        Win!
      </a>
      <span id="level3-lock-text" class="level-lock-text">Score 40+ on Level 2 to unlock this level.</span>
    </nav>
    <p id="win-progress" class="level-requirement win-progress">
      Score 175 or more on Level 3 to unlock Win! above.
    </p>
    <p id="level3-locked-message" class="level-lock-banner" hidden>
      Score 40 or more on Level 2 to unlock the roaming backboard finale. Your best control runs will appear here once
      unlocked.
    </p>
    <div id="hud">
      <span id="score">Score: 0</span>
      <span id="balls">Balls in play: 0</span>
      <span id="timer">Timer: 0.0s</span>
      <button id="shoot">Start Board Drill</button>
      <button id="stop" disabled>Stop</button>
    </div>
    <p class="level-intro">
      Level 3: the portable backboard is finally online. Drag it with your pointer or steer it with WASD/arrow keys to bend
      rebounds into the hoop. Ten seconds of rapid fire still rain down—keep the board nimble as ricochets settle before the
      buzzer tallies your score.
    </p>
    <div id="controls">
      <label for="angle-control">
        Angle boost
        <input type="range" id="angle-control" min="-0.25" max="0.83" step="0.01" value="0.18" />
        <span id="angle-display">+10.3°</span>
      </label>
      <label for="power-control">
        Launch power
        <input type="range" id="power-control" min="14" max="39" step="0.1" value="19.5" />
        <span id="power-display">19.5 u/s</span>
      </label>
    </div>
    <div class="court-wrapper">
      <canvas id="court" width="960" height="540"></canvas>
      <div id="score-flash" role="status" aria-live="polite"></div>
    </div>
    <p>Unleash a cascade of free throws! Hit the button to fire 20 balls a second for ten straight seconds. Shots ricochet off the floor, the wall, and even each other. Sink them through the hoop before time runs out.</p>
    <section id="run-history">
      <h2>Top 10 Runs</h2>
      <table>
        <thead>
          <tr>
            <th scope="col">Rank</th>
            <th scope="col">Timestamp</th>
            <th scope="col">Angle Boost</th>
            <th scope="col">Launch Power</th>
            <th scope="col">Spawn Rate</th>
            <th scope="col">Duration</th>
            <th scope="col">Score</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>
  </main>

  <script src="../shared/achievements.js"></script>
  <script src="common.js"></script>
  <script>
    window.RapidFireFreeThrows.initGame({
      historyCookie: 'rapid_fire_runs_level3_v1',
      levelKey: 'level3',
      unlockThreshold: 40,
      unlockLockedText: 'Score 40+ on Level 2 to unlock this level.',
      unlockUnlockedText: '',
      level2LockTextId: 'level3-lock-text',
      lockBannerId: 'level3-locked-message',
      scoreFlashId: 'score-flash',
      simulationDurationMs: 12000,
      disableUntilUnlocked: true,
      board: {
        width: 11.5,
        aspect: 264 / 8000,
        x: 19.2,
        y: 8.4,
        speed: 13,
        restitution: 0.92,
        padding: 0.6,
        verticalPadding: 0.6,
        textureUrl: 'assets/board.png'
      },
      win: {
        threshold: 175,
        linkId: 'win-link',
        messageId: 'win-progress',
        storageKey: 'rapid_fire_free_throws_level3_victory_unlocked',
        lockedText: 'Score 175 or more on Level 3 to unlock Win! above.',
        unlockedText: 'Victory unlocked! Tap Win! above to celebrate your board mastery.'
      },
      getUnlockScore: helpers => helpers.getBestScoreFromCookie('rapid_fire_runs_level2_v2')
    });
  </script>


</body>
</html>
